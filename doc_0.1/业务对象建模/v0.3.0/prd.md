# 《数据理解 × 业务对象发布》PRD（简化发布模型版）

## 1. 背景与设计原则

### 1.1 背景

当前平台已经具备：

* 基于逻辑视图的**字段语义理解能力**
* AI 生成 **候选业务对象**
* 人工参与的 **业务对象建模**
* 对象 → 表字段的 **语义映射能力**

但在**发布模型**上：

* 引入“语义版本”会显著增加用户理解成本
* 当前阶段核心目标是：**让语义能尽快稳定对外使用**

---

### 1.2 本 PRD 的核心决策（非常重要）

> ✅ **暂不引入“语义版本”概念**

> ✅ **业务对象发布 = 当前系统唯一生效语义**

> ✅ **每次发布直接覆盖上一版本（Latest Wins）**

> 语义版本作为 **未来增强能力预留**，不进入本期设计。

---

### 1.3 设计原则

1. **以业务对象为发布最小单元**
2. **发布前强校验，发布后强一致**
3. **字段语义理解是输入，业务对象是输出**
4. **任何不确定性必须在发布前解决**

---

## 2. 总体流程总览（用户视角）

```
数据源 / 表
   ↓
逻辑视图
   ↓
字段语义理解（AI + 人）
   ↓
候选业务对象（AI）
   ↓
业务对象建模（确认 / 冲突解决）
   ↓
业务对象发布（覆盖生效）
```

---

## 3. 功能模块与职责边界

### 3.1 模块划分（简化后）

| 模块     | 职责             |
| ------ | -------------- |
| 逻辑视图   | 承载字段结构与统计信息    |
| 字段语义理解 | 对字段进行语义标注、角色判断 |
| 候选业务对象 | AI 生成的对象建议集合   |
| 业务对象建模 | 人工确认、治理、映射     |
| 发布     | 校验 + 生效        |

> ⚠️ **不再存在独立的「语义版本管理」页面**

---

## 4. 字段语义理解（输入阶段）

### 4.1 功能目标

* 将“物理字段”转为“可被业务理解的字段语义”
* 为后续 **对象识别、属性归并、主键判断**提供依据

---

### 4.2 核心功能点

#### 字段语义标注

* 业务名称（业务含义）
* 字段角色（对应数据理解里面的字段角色）
* 业务域（可选）

#### AI 能力

* 自动语义建议
* 主键/外键候选判断
* -- 敏感字段识别（可复用已有安全能力）--

---

### 4.3 状态

| 状态     | 含义      |
| ------ | ------- |
| 未理解    | 未执行语义理解 |
| AI 建议中 | 已生成建议   |
| 已确认    | 人工确认完成  |

---

## 5. 候选业务对象（AI 中间产物）

### 5.1 定位（非常关键）

> **候选业务对象 ≠ 业务对象**
> 它是：**字段语义理解结果 → 业务对象的 AI 建议层**

---

### 5.2 来源

* 单表 / 多表
* 基于字段角色、命名、关联推断

---

### 5.3 可执行操作

| 操作   | 说明            |
| ---- | ------------- |
| 查看建议 | 看对象名称、属性组成、来源 |
| 接受   | 转为“业务对象（待治理）” |
| 拒绝   | 不进入业务建模       |
| 合并   | 与已有对象合并       |
| 改名   | 修正语义          |

---

### 5.4 状态

| 状态        | 说明     |
| --------- | ------ |
| Candidate | AI 生成  |
| Accepted  | 已转业务对象 |
| Rejected  | 已拒绝    |

---

## 6. 业务对象建模（核心治理阶段）

### 6.1 业务对象的定义

一个业务对象包含：

* 对象元信息

  * 名称 / 编码 / 业务域 / 负责人
* 属性定义

  * 类型、是否必填、是否主键
* 映射关系

  * 属性 → 表字段

---

### 6.2 业务对象状态机（简化版）

```
DRAFT / PENDING
     ↓
READY（满足发布条件）
     ↓
PUBLISHED（已生效）
```

#### 状态说明

| 状态              | 含义       |
| --------------- | -------- |
| DRAFT / PENDING | 编辑中，不可发布 |
| READY           | 满足发布条件   |
| PUBLISHED       | 当前生效     |

---

### 6.3 发布前强校验规则（硬约束）

业务对象 **必须全部满足** 才允许发布：

1. ❌ 无对象冲突
2. ✅ 至少一个主键属性
3. ✅ 必填属性已定义
4. ✅ 映射完成度 = 100%
5. ❌ 不存在未解决冲突对象

> 任一不满足 → **禁止发布**

---

## 7. 发布模型（无版本）

### 7.1 发布粒度

* 支持：

  * 单个业务对象发布
  * 多个业务对象批量发布
* **发布结果：立即覆盖系统当前生效语义**

---

### 7.2 发布行为定义（工程级）

```text
发布 = 将业务对象状态置为 PUBLISHED
并使其成为系统当前唯一生效定义
```

---

### 7.3 发布规则

| 场景         | 行为      |
| ---------- | ------- |
| 已存在同名对象    | 必须先解决冲突 |
| 已发布对象再次发布  | 覆盖原定义   |
| 存在一个不可发布对象 | 整体发布失败  |

---

### 7.4 发布失败提示（统一）

```text
当前存在未满足发布条件的业务对象：
- 对象 A：存在未解决冲突
- 对象 B：映射未完成
```

---

## 8. 页面与交互职责澄清

### 8.1 逻辑视图页面

| 页面  | 作用              |
| --- | --------------- |
| 列表页 | 选择进入字段语义理解      |
| 详情页 | 查看字段结构 + 触发语义理解 |

> ❌ 不做对象治理

---

### 8.2 候选业务对象页面

| 能力        | 是否保留 |
| --------- | ---- |
| AI 建议查看   | ✅    |
| 批量接受 / 拒绝 | ✅    |
| 冲突预警      | ✅    |

---

### 8.3 业务对象建模页面

这是**唯一治理主阵地**：

* 对象列表：状态、映射进度、是否可发布
* 对象详情：

  * 属性定义
  * 映射概览
  * 冲突提示
* 语义映射工作台：**只负责映射，不负责发布**

---

## 9. 角色视角（给测试 & 项目用）

### 测试关注点

* 发布前校验是否覆盖所有阻塞条件
* 任一对象不合法 → 发布失败
* 发布后状态是否原子更新

---

### 前端关注点

* 发布按钮是否可点击 = 后端校验结果
* Banner 文案来自后端阻塞原因
* 页面不自行推断发布条件

---

### 后端关注点

* 发布接口必须是原子操作
* 校验逻辑统一
* 返回结构化阻塞原因

---

## 10. 明确不做的事情（本期）

* ❌ 不做语义版本历史管理
* ❌ 不支持多版本并行生效
* ❌ 不支持发布回滚（仅覆盖）

---

## 11. 为未来预留的扩展点（不实现）

* 在发布动作中引入 version_id
* 历史发布记录
* 灰度发布 / 多环境语义

---

## 12. 一句话总结

> **本期目标不是“管理语义版本”，
> 而是“让数据语义第一次真正稳定、可用、可发布”。**


