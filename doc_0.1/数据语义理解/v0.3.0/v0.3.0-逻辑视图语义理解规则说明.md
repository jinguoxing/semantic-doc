# 逻辑视图语义理解规则说明（v0.3.0）

> 适用范围： 数据语义治理平台
> 覆盖对象：字段级语义理解 → 表级语义理解
> 治理原则：AI 产出 Suggestion，人做 Decision，版本化生效

---


## 1. 整体语义理解链路（先给全貌）

```text
逻辑视图（表）
  └─ 字段特征采集
       ├─ 命名特征
       ├─ 结构特征
       ├─ 数据分布特征
       ├─ 质量探查信号
  └─ 字段语义理解（Suggestion）
       ├─ 字段角色（Role）
       ├─ 业务含义（Term）
       ├─ 语义标签（Tag）
       ├─ 风险与置信度
  └─ 字段裁决（Decision）
  └─ 表级语义聚合
       ├─ 表类型理解
       ├─ 主体 / 行为 / 状态判定
       ├─ 表级置信度
```

---

## 2. 字段语义理解：输入特征说明（Field Signals）

### 2.1 命名特征（Naming Signals）

| 维度   | 示例                     | 说明                |
| ---- | ---------------------- | ----------------- |
| 字段名  | order_status           | 最强语义信号            |
| 词缀   | _id / _time / _flag    | 高置信规则             |
| 分词   | order + status         | 用于 Role / Term 匹配 |
| 业务词典 | status / amount / date | 来自术语库             |

**规则示例**

* 包含 `id` 且唯一性高 → Identifier 候选
* 包含 `time/date` → Time 候选
* 包含 `status/state` → Status 候选

---

### 2.2 结构特征（Schema Signals）

| 维度   | 示例                   | 说明             |
| ---- | -------------------- | -------------- |
| 数据类型 | int / varchar / date | Role 强约束       |
| 是否主键 | PK                   | Identifier 强信号 |
| 是否外键 | FK                   | ForeignKey 强信号 |
| 是否可空 | NOT NULL             | 重要性判断          |

**规则示例**

* date/timestamp → 不可能是 Measure
* varchar + FK → 高概率字典/状态

---

### 2.3 数据分布特征（Profile Signals）

| 维度             | 示例          | 说明       |
| -------------- | ----------- | -------- |
| distinct_count | 5           | 判断枚举/状态  |
| null_rate      | 0.8         | 判断可选属性   |
| top_values     | PAID/CANCEL | 业务语义直接证据 |
| value_length   | 固定长度        | 编码/枚举    |

**规则示例**

* distinct_count 很小 → Status / Enum
* distinct_count 接近行数 → Identifier
* 高 null_rate → 非关键字段

---

### 2.4 质量探查信号（Quality Signals）

> 不是“质量合不合格”，而是**质量对语义理解的支撑度**

| 信号   | 用途            |
| ---- | ------------- |
| 唯一性  | 支撑 Identifier |
| 非空率  | 判断业务关键性       |
| 值稳定性 | 枚举 / 状态可靠性    |
| 异常比例 | 降低置信度         |

**重要原则**

> 质量信号 **只影响置信度与风险**，
> 不直接决定字段语义结论。

---

## 3. 字段语义理解：输出规则（Field Semantics）

### 3.1 字段角色（Role）判定规则

| Role       | 判定依据                      |
| ---------- | ------------------------- |
| Identifier | 名称 + 唯一性 + 非空             |
| ForeignKey | 命名 + FK 关系                |
| Status     | 命名 + 枚举分布                 |
| Time       | 类型 + 命名                   |
| Measure    | 数值型 + 可聚合                 |
| Attribute  | 默认兜底                      |
| Audit      | create_time / update_user |
| Technical  | hash / version            |

> Role 是**字段语义理解的唯一必选项**

---

### 3.2 业务术语（Term）匹配规则 （暂不关联）

* 基于字段名 + 表上下文
* 与术语库相似度匹配
* 多候选时按置信度排序

**注意**

> Term 永远是“建议”，必须人工确认

---

### 3.3 标签（Tag）规则（暂不关联）

| 标签类型 | 来源             |
| ---- | -------------- |
| 业务标签 | Role / Term 派生 |
| 治理标签 | 质量 / 风险        |
| 技术标签 | 类型 / 架构        |

---

## 4. 字段置信度计算规则（Field Confidence）

### 4.1 基本公式（工程可实现）

```text
FieldConfidence =
  w1 * NamingScore
+ w2 * SchemaScore
+ w3 * ProfileScore
+ w4 * QualityScore
```

### 4.2 推荐权重（v2.4）

| 信号 | 权重  |
| -- | --- |
| 命名 | 0.4 |
| 结构 | 0.3 |
| 分布 | 0.2 |
| 质量 | 0.1 |

> 命名 + 结构 > 数据统计
> 这是符合人类认知的。

---

### 4.3 置信度分级（前端展示）

| 数值      | 等级 | 行为     |
| ------- | -- | ------ |
| ≥0.9    | 高  | 允许批量接受 |
| 0.7–0.9 | 中  | 建议人工确认 |
| <0.7    | 低  | 高亮风险   |

---

## 5. 表级语义理解（Table Semantics）

### 5.1 表级理解不是“重新分析表”，而是**字段聚合**

```text
TableSemantic =
  aggregate(FieldRoles, FieldConfidence)
```

---

### 5.2 表类型判定规则（主体 / 行为 / 状态）

| 表类型 | 判定条件                     |
| --- | ------------------------ |
| 主体表 | Identifier + 多 Attribute |
| 行为表 | 多 Time + Measure         |
| 状态表 | Status + 外键              |

---

### 5.3 表级置信度计算

```text
TableConfidence =
  Σ(FieldConfidence * FieldWeight) / Σ(FieldWeight)
```

**FieldWeight 示例**

* Identifier / Status：2
* Time / Measure：1.5
* Attribute：1

---

## 6. 阻塞与风险规则（治理联动）

| 场景             | 行为            |
| -------------- | ------------- |
| 关键字段无 Decision | 阻塞进入对象建模      |
| 高风险字段未处理       | 表状态 = 字段语义待确认 |
| 置信度过低          | 强制人工裁决        |

---

## 7. 用户视角的“白话版理解”

> 系统不是拍脑袋理解字段，而是：
>
> 1. 看名字像不像
> 2. 看结构合不合理
> 3. 看数据长什么样
> 4. 看数据稳不稳定
>
> 然后给你一个**有证据、有置信度的建议**，
> 最终由你来确认是否成立。

---


## 8. 一句话总结

> 逻辑视图的语义理解，是以字段为最小单元，
> 通过多维特征与质量信号形成可解释建议，
> 再由字段聚合出表级语义与建模阶段判断。


